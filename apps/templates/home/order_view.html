{% extends 'layouts/base.html' %}

{% block title %} Order Pemesanan {% endblock title %}

{% block content %}

{% load my_filter %}

{% load humanize %}

{% load mathfilters %}

{% load user_agents %}

<form action="" method="post" id="order-form" enctype="multipart/form-data">
    <div class="container-fluid mt-0">
        <div class="row">
            <div class="col-xl-12 order-xl-1">
                {% csrf_token %}
                <div class="card {% if request|is_mobile %}z-index-0{% endif %}">
                    <div class="card-header">
                        <div class="row">
                            <div class="{% if request|is_mobile %}col-10{% else %}col-6{% endif %} d-flex align-items-center">
                                <h5 class="mb-4">Order Pemesanan: {% if request|is_mobile %}<br><span class="text-sm">{{ data.order_id }}</span>{% else %}{{ data.order_id }}{% endif %}</h5>
                            </div>
                            {% if request|is_mobile %}
                            <div class="col-2 text-end">
                                <div class="dropdown float-lg-end pe-2">
                                    <a class="cursor-pointer text-body" id="dropdownTable" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </a>
                                    <ul class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5 z-index-3" aria-labelledby="dropdownTable">
                                        <li><a class="dropdown-item border-radius-md" href="{% if crud == 'view' %}{% url 'order-index' %}{% else %}{% url 'order-view' data.order_id '0' '0' '0' '0' %}{% endif %}">{% if crud == 'view' %}Kembali{% else %}Batal{% endif %}</a></li>
                                        <li><a class="dropdown-item border-radius-md" {% if not btn.edit and not request.user.is_superuser %}hidden{% endif %}{% if status == 'BATAL' %}hidden{% endif %} {% if crud == 'update' %}hidden{% endif %} href="{% url 'order-cs-update' data.order_id '0' '0' '0' %}">Ubah</a></li>
                                        <li><button class="dropdown-item border-radius-md text-body" id="save-btn" type="submit" {% if crud == 'view' %}hidden{% endif %}>Simpan</button></li>
                                        <li><a class="dropdown-item border-radius-md" {% if status != 'DRAFT' %}hidden{% else %}{% if not btn.edit and not request.user.is_superuser %}hidden{% else %}{% if crud == 'update' %}hidden{% endif %}{% endif %}{% endif %} data-bs-toggle="modal" data-bs-target="#confirm-{{ data.order_id }}">Confirmed</a></li>
                                        <li><a class="dropdown-item border-radius-md text-primary" {% if status == 'SELESAI' or status == 'BATAL' %}hidden{% else %}{% if not btn.delete and not request.user.is_superuser %}hidden{% else %}{% if crud == 'update' %}hidden{% endif %}{% endif %}{% endif %} data-bs-toggle="modal" data-bs-target="#cancel">Batal</a></li>
                                    </ul>
                                </div>
                            </div>
                            {% else %}
                            <div class="col-6 text-end">
                                <a href="{% if crud == 'view' %}{% url 'order-index' %}{% else %}{% url 'order-view' data.order_id '0' '0' '0' '0' %}{% endif %}" class="btn btn-sm bg-gradient-dark mb-0 px-3"><i class="fas fa-reply"></i>&nbsp;&nbsp;{% if crud == 'view' %}Kembali{% else %}Batal{% endif %}</a>
                                <a href="{% url 'order-cs-update' data.order_id '0' '0' '0' %}" class="btn btn-sm bg-gradient-dark mb-0 px-4 {% if not btn.edit and not request.user.is_superuser %}disabled{% endif %}{% if status == 'BATAL' %}disabled{% endif %}" {% if crud == 'update' %}hidden{% endif %}><i class="fas fa-edit"></i>&nbsp;&nbsp;Ubah</a>
                                <button type="submit" id="save-btn" class="btn btn-sm bg-gradient-dark mb-0 px-4" {% if crud == 'view' %}hidden{% endif %}><i class="fas fa-save"></i>&nbsp;&nbsp;Simpan</button>
                                <button type="button" class="btn btn-sm bg-gradient-dark mb-0 px-4 {% if status != 'DRAFT' %}disabled{% else %}{% if not btn.edit and not request.user.is_superuser %}disabled{% else %}{% if crud == 'update' %}disabled{% endif %}{% endif %}{% endif %}" data-bs-toggle="modal" data-bs-target="#confirm-{{ data.order_id }}"><i class="fas fa-check"></i>&nbsp;&nbsp;Confirmed</button>
                                <button type="button" class="btn btn-sm bg-gradient-primary mb-0 px-4 {% if status == 'SELESAI' or status == 'BATAL' %}disabled{% else %}{% if not btn.delete and not request.user.is_superuser %}disabled{% else %}{% if crud == 'update' %}disabled{% endif %}{% endif %}{% endif %}" data-bs-toggle="modal" data-bs-target="#cancel"><i class="fas fa-times-circle"></i>&nbsp;&nbsp;Batal</button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal fade" id="confirm-{{ data.order_id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="ModalLabel">Konfirmasi</h5>
                                </div>
                                <div class="modal-body border-bottom-0">
                                    Anda yakin ingin mengubah status order no. <strong>{{ data.order_id }}</strong> menjadi CONFIRMED?
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-sm bg-gradient-dark" data-bs-dismiss="modal">Kembali</button>
                                    <a href="{% url 'order-confirmed' data.order_id %}" role="button" class="btn btn-sm bg-gradient-warning text-white">Confirmed</a>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="cancel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="ModalLabel">Konfirmasi</h5>
                                </div>
                                <div class="modal-body border-bottom-0">
                                    Anda yakin ingin membatalkan order no. <strong>{{ data.order_id }}</strong>?
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-sm bg-gradient-dark" data-bs-dismiss="modal">Kembali</button>
                                    <a href="{% url 'order-cancel' data.order_id %}" role="button" class="btn btn-sm bg-gradient-warning text-white">Batalkan Order</a>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="pl-lg-0">
                            {% if msg %}
                            <div class="alert text-danger text-bg-light mt-2" role="alert">
                                {{ msg }}
                            </div>
                            {% endif %}
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="shadow-none">
                                                <label class="form-control-label" for="id-customer-name">Nama Lengkap Pemesan</label>
                                                <input type="text" name="customer_name" id="id-customer-name" class="form-control form-control-sm" value="{{ data.customer_name }}" {% if crud == 'view' %}readonly{% endif %}>
                                            </div>  
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="shadow-none">
                                                <label class="form-control-label" for="id-customer-phone">Telepon 1</label>
                                                <input type="text" name="customer_phone" id="id-customer-phone" class="form-control form-control-sm" value="{{ data.customer_phone }}" {% if crud == 'view' %}readonly{% endif %}>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="shadow-none">
                                                <label class="form-control-label" for="id-customer-phone2">Telepon 2</label>
                                                <input type="text" name="customer_phone2" id="id-customer-phone2" class="form-control form-control-sm" value="{{ data.customer_phone2 }}" {% if crud == 'view' %}readonly{% endif %}>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-customer-address">Alamat Lengkap Pengiriman</label>
                                        <textarea name="customer_address" id="id-customer-address" class="form-control form-control-sm" rows="4" {% if crud == 'view' %}readonly{% endif %}>{{ data.customer_address }}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="input-customer-email">Email</label>
                                        <input type="text" name="customer_email" id="id-customer-email" class="form-control form-control-sm" value="{{ data.customer_email }}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-customer-district">Kecamatan</label>
                                        <input type="text" name="customer_district" id="id-customer-district" class="form-control form-control-sm" value="{{ data.customer_district }}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-customer-city">Kota/Kabupaten</label>
                                        <input type="text" name="customer_city" id="id-customer-city" class="form-control form-control-sm" value="{{ data.customer_city }}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-customer-province">Propinsi</label>
                                        <input type="text" name="customer_province" id="id-customer-province" class="form-control form-control-sm" value="{{ data.customer_province }}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-delivery-date">Tanggal Pengiriman</label>
                                        <input type="date" name="delivery_date" id="id-delivery-date" class="form-control form-control-sm" value="{{ data.delivery_date|date:'Y-m-d' }}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-time-arrival">Jam Acara</label>
                                        <input type="time" name="time_arrival" id="id-time-arrival" class="form-control form-control-sm" value="{{ data.time_arrival }}" data-provide="timepicker" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid pt-3">
        <div class="row">
            <div class="col-12">
                <div class="card pb-4 px-4 pt-2">
                    <div class="row">
                        <div class="col-4 d-flex align-items-center">
                            <h5 class="mb-4 mt-3">Konfirmasi</h5>
                        </div>
                        <div class="col-8 text-end shadow-none pt-1">
                            <span class="badge rounded-pill badge-notification bg-gradient-primary mt-3 text-white px-3 py-1">{{ data.order_status }}</span>
                        </div>
                    </div>
                    <div class="card-body px-0 pt-0 pb-1">
                        <div class="pl-lg-0">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="input-username">Total Biaya Paket Aqiqah</label>
                                        <h5 class="text-bolder ps-1">Rp. {{ data.total_order|intcomma }}</h5>
                                    </div>  
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-discount">Diskon</label>
                                        <input type="text" name="discount" id="id-discount" class="form-control form-control-sm" value="{% if crud == 'view' %}{{ data.discount|intcomma }}{% else %}{{ data.discount }}{% endif %}" {% if crud == 'view' %}readonly{% endif %}>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="input-username">Down Payment</label>
                                        <h5 class="text-bolder ps-1">Rp. {{ data.down_payment|intcomma }}</h5>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="input-username">Sisa Pembayaran</label>
                                        <h5 class="text-bolder ps-1">Rp. {{ data.pending_payment|intcomma }}</h5>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-use-photo">Sertifikat dan Kartu Ucapan pakai foto atau tidak?</label>
                                        <select class="form-control form-select-sm" name="use_photo" id="id-use-photo" initial=0 {% if crud == 'view' %}disabled{% endif %}>
                                            <option value=1 {% if data.use_photo == 1 %} selected {% endif %}>Ya</option>
                                            <option value=0 {% if data.use_photo == 0 %} selected {% endif %}>Tidak</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-witnessed">Penyembelihan disaksikan?</label>
                                        <select class="form-control form-select-sm" name="witnessed" id="id-witnessed" initial="0" {% if crud == 'view' %}disabled{% endif %}>
                                            <option value=1 {% if data.witnessed == 1 %} selected {% endif %}>Ya</option>
                                            <option value=0 {% if data.witnessed == 0 %} selected {% endif %}>Tidak</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-info-source">Sumber informasi?</label>
                                        <select class="form-control form-select-sm" name="info_source" id="id-info-source" {% if crud == 'view' %}disabled{% endif %}>
                                            <option value="">Pilih sumber informasi</option>
                                            <option value="Google" {% if data.info_source == 'Google' %} selected {% endif %}>Google</option>
                                            <option value="Instagram" {% if data.info_source == 'Instagram' %} selected {% endif %}>Instagram</option>
                                            <option value="Facebook" {% if data.info_source == 'Facebook' %} selected {% endif %}>Facebook</option>
                                            <option value="Tiktok" {% if data.info_source == 'Tiktok' %} selected {% endif %}>Tiktok</option>
                                            <option value="Youtube" {% if data.info_source == 'Youtube' %} selected {% endif %}>Youtube</option>
                                            <option value="Referensi" {% if data.info_source == 'Referensi' %} selected {% endif %}>Referensi</option>
                                            <option value="Kantor" {% if data.info_source == 'Kantor' %} selected {% endif %}>Kantor</option>
                                            <option value="Brosur" {% if data.info_source == 'Brosur' %} selected {% endif %}>Brosur</option>
                                            <option value="Kerabat" {% if data.info_source == 'Kerabat' %} selected {% endif %}>Kerabat</option>
                                            <option value="Repeat Order" {% if data.info_source == 'Repeat Order' %} selected {% endif %}>Repeat Order</option>
                                            <option value="Website" {% if data.info_source == 'Website' %} selected {% endif %}>Website</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-order-note">Catatan</label>
                                        <textarea class="form-control form-control-sm" name="order_note" id="id-order-note" rows="4" {% if crud == 'view' %}readonly{% endif %}>{% if data.order_note %}{{ data.order_note }}{% endif %}</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="container-fluid pt-3 pb-2">
    <div class="row">
        <div class="col-12">
            <div class="card mb-0 p-4 {% if request|is_mobile %}z-index-0{% endif %}">
                <div class="row mb-3">
                    <div class="col-8 d-flex align-items-center">
                        <h5 class="mb-2">Informasi Anak</h5>
                    </div>
                    <div class="col-4 text-end">
                        {% if request|is_mobile %}
                        <div class="dropdown float-lg-end pe-2" {% if status == 'BATAL' or status == 'SELESAI' %}hidden{% else %}{% if not btn.edit and not request.user.is_superuser %}hidden{% endif %} {% if crud == 'update' %}hidden{% endif %}{% endif %}>
                            <a class="cursor-pointer text-body" id="dropdownAnak" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </a>
                            <ul class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5 z-index-3" aria-labelledby="dropdownAnak">
                                <li><a class="dropdown-item border-radius-md" data-bs-toggle="modal" href="#addAnak">Tambah Anak</a></li>
                            </ul>
                        </div>
                        {% else %}
                        <button type="button" class="btn btn-sm bg-gradient-dark mb-0 {% if status == 'BATAL' or status == 'SELESAI' %}disabled{% else %}{% if not btn.edit and not request.user.is_superuser %}disabled{% endif %} {% if crud == 'update' %}disabled{% endif %}{% endif %}" data-bs-toggle="modal" data-bs-target="#addAnak"><i class="fas fa-plus"></i>&nbsp;&nbsp;Tambah Anak</button>
                        {% endif %}
                    </div>
                </div>
                <div class="modal fade" id="addAnak" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="ModalLabel">Tambah Anak</h5>
                            </div>
                            <form method="post" action="{% url 'order-cs-child-add' data.order_id %}" enctype="multipart/form-data">
                                {% csrf_token %}
                                <div class="modal-body border-bottom-0">
                                    <div class="pl-lg-0">
                                        <!-- {% if message != '0' %}
                                        <div class="alert text-danger text-bg-light" role="alert">
                                            {{ message }}
                                        </div>
                                        {% endif %} -->
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="shadow-none">
                                                    <label class="form-control-label" for="id-child-name">Nama Anak</label>
                                                    <input type="text" name="child_name" id="id-child-name" class="form-control form-control-sm" required>
                                                    <div class="text-sm text-danger">
                                                        {{ formChild.child_name.errors }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="shadow-none">
                                                    <label class="form-control-label" for="id-child-birth">Tanggal Lahir</label>
                                                    <input type="date" name="child_birth" id="id-child-birth" class="form-control form-control-sm" required>
                                                    <div class="text-sm text-danger">
                                                        {{ formChild.child_birth.errors }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="shadow-none">
                                                    <label class="form-control-label" for="id-child-sex">Jenis Kelamin</label>
                                                    <select class="form-control form-select-sm" name="child_sex" id="id-child-sex" required>
                                                        <option value="">Pilih jenis kelamin</option>
                                                        <option value="1">Laki-laki</option>
                                                        <option value="2">Perempuan</option>
                                                    </select>
                                                    <div class="text-sm text-danger">
                                                        {{ formChild.child_sex.errors }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="shadow-none">
                                                    <label class="form-control-label" for="id-child-father">Nama Ayah</label>
                                                    <input type="text" name="child_father" id="id-child-father" class="form-control form-control-sm" required>
                                                    <div class="text-sm text-danger">
                                                        {{ formChild.child_father.errors }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="shadow-none">
                                                    <label class="form-control-label" for="id-child-mother">Nama Ibu</label>
                                                    <input type="text" name="child_mother" id="id-child-mother" class="form-control form-control-sm" required>
                                                    <div class="text-sm text-danger">
                                                        {{ formChild.child_mother.errors }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer border-0">
                                    <button type="button" class="btn btn-sm bg-gradient-dark" data-bs-dismiss="modal">Batal</button>
                                    <button type="submit"
                                        class="btn btn-sm bg-gradient-warning text-white {% if not btn.edit and not request.user.is_superuser %}disabled{% endif %}">Simpan</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="card-body px-0 pt-0 pb-1">
                    <div class="table-responsive p-0">
                        <table class="table {% if crud == 'view' %}hover{% endif %} align-items-center mb-0" id="childTable">
                            <thead>
                                <tr>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Nama Anak</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Tanggal Lahir</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Jenis Kelamin</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Nama Ayah</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Nama Ibu</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in child %}
                                <tr {% if crud == 'view' %}class="cursor-pointer" data-bs-toggle="modal" data-bs-target="#update-{{ item.id }}"{% endif %}>
                                    <td>
                                        <div class="d-flex pe-2 py-0">
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-xs">{{ item.child_name }}</h6>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{{ item.child_birth|date:'d F Y' }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{% if item.child_sex == 1 %}Laki-laki{% else %}Perempuan{% endif %}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{{ item.child_father }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{{ item.child_mother }}</h6>
                                    </td>
                                    <td>
                                        <button class="btn-icon-only text-dark bg-transparent border-0 p-0 m-0" data-bs-toggle="modal" {% if btn.edit or request.user.is_superuser %}data-bs-target="#delete-{{ item.id }}"{% else %}disabled{% endif %} {% if crud == 'update' %}disabled{% endif %} {% if data.order_status == 'BATAL' or data.order_status == 'SELESAI' %}disabled{% endif %} {% if child|length == 1 %}disabled{% endif %}><i class="fas fa-times-circle"></i></button>
                                    </td>
                                    <div class="modal fade" id="delete-{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                        aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="ModalLabel">Konfirmasi</h5>
                                                </div>
                                                <div class="modal-body border-bottom-0">
                                                    Anda yakin akan menghapus data anak <strong>{{ item.child_name }}</strong>?
                                                </div>
                                                <div class="modal-footer border-0">
                                                    <button role="button" class="btn bg-gradient-dark" data-bs-dismiss="modal">Batal</button>
                                                    <a href="{% url 'order-child-cs-delete' data.order_id item.id %}" role="button" class="btn bg-gradient-warning text-white">Hapus
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </tr>
                                <div class="modal fade" id="update-{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="ModalLabel">Update Anak</h5>
                                            </div>
                                            <form method="post" action="{% url 'order-child-cs-update' data.order_id item.id %}" enctype="multipart/form-data">
                                                {% csrf_token %}
                                                <div class="modal-body border-bottom-0">
                                                    <div class="pl-lg-0">
                                                        <!-- {% if message != '0' %}
                                                        <div class="alert text-danger text-bg-light" role="alert">
                                                            {{ message }}
                                                        </div>
                                                        {% endif %} -->
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="shadow-none">
                                                                    <label class="form-control-label" for="id-child-name">Nama Anak</label>
                                                                    <input type="text" name="child_name" id="id-child-name" class="form-control form-control-sm" value="{{ item.child_name }}" required>
                                                                    <div class="text-sm text-danger">
                                                                        {{ formChild.child_name.errors }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="shadow-none">
                                                                    <label class="form-control-label" for="id-child-birth">Tanggal Lahir</label>
                                                                    <input type="date" name="child_birth" id="id-child-birth" class="form-control form-control-sm" value="{{ item.child_birth|date:'Y-m-d' }}" required>
                                                                    <div class="text-sm text-danger">
                                                                        {{ formChild.child_birth.errors }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="shadow-none">
                                                                    <label class="form-control-label" for="id-child-sex">Jenis Kelamin</label>
                                                                    <select class="form-control form-select-sm" name="child_sex" id="id-child-sex" required>
                                                                        <option value="">Pilih jenis kelamin</option>
                                                                        <option value="1" {% if item.child_sex == "1" %}selected{% endif %}>Laki-laki</option>
                                                                        <option value="2" {% if item.child_sex == "2" %}selected{% endif %}>Perempuan</option>
                                                                    </select>
                                                                    <div class="text-sm text-danger">
                                                                        {{ formChild.child_sex.errors }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="shadow-none">
                                                                    <label class="form-control-label" for="id-child-father">Nama Ayah</label>
                                                                    <input type="text" name="child_father" id="id-child-father" class="form-control form-control-sm" value="{{ item.child_father }}" required>
                                                                    <div class="text-sm text-danger">
                                                                        {{ formChild.child_father.errors }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="shadow-none">
                                                                    <label class="form-control-label" for="id-child-mother">Nama Ibu</label>
                                                                    <input type="text" name="child_mother" id="id-child-mother" class="form-control form-control-sm" value="{{ item.child_mother }}" required>
                                                                    <div class="text-sm text-danger">
                                                                        {{ formChild.child_mother.errors }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer border-0">
                                                    <button type="button" class="btn btn-sm bg-gradient-dark" data-bs-dismiss="modal">Batal</button>
                                                    <button type="submit"
                                                        class="btn btn-sm bg-gradient-warning text-white {% if not btn.edit and not request.user.is_superuser %}disabled{% endif %} {% if status == 'BATAL' or status == 'SELESAI' %}disabled{% else %}{% if crud == 'update' %}disabled{% endif %}{% endif %}">Simpan</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid py-2">
    <div class="row">
        {%  if message %}
        <div class="alert text-danger text-bg-light" role="alert">
            {{ message }}
        </div>
        {% endif %}
        <div class="col-12">
            <div class="card mb-5 p-4 {% if request|is_mobile %}z-index-0{% endif %}">
                <div class="row mb-3">
                    <div class="col-6 d-flex align-items-center">
                        <h5 class="mb-2">Paket Aqiqah</h5>
                    </div>
                    <div class="col-6 text-end">
                        {% if request|is_mobile %}
                        <div class="dropdown float-lg-end pe-2" {% if status == 'BATAL' or status == 'SELESAI' %}hidden{% else %}{% if not btn.edit and not request.user.is_superuser %}hidden{% endif %} {% if crud == 'update' %}hidden{% endif %}{% endif %}>
                            <a class="cursor-pointer text-body" id="dropdownPaket" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </a>
                            <ul class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5 z-index-3" aria-labelledby="dropdownPaket">
                                <li><a class="dropdown-item border-radius-md" data-bs-toggle="modal" href="#addPaket">Tambah Paket</a></li>
                            </ul>
                        </div>
                        {% else %}
                        <button type="button" class="btn btn-sm bg-gradient-dark mb-0 {% if status == 'BATAL' or status == 'SELESAI' %}disabled{% else %}{% if not btn.edit and not request.user.is_superuser %}disabled{% endif %} {% if crud == 'update' %}disabled{% endif %}{% endif %}" data-bs-toggle="modal" data-bs-target="#addPaket"><i class="fas fa-plus"></i>&nbsp;&nbsp;Tambah Paket</button>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body px-0 pt-0 pb-1">
                    <div class="table-responsive p-0">
                        <table class="table {% if crud == 'view' %}hover{% endif %} align-items-center mb-0" id="packTable">
                            <thead>
                                <tr>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Kategori Paket</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Paket</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Menu Daging</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">
                                        Menu Olahan</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end">Jumlah Box</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Domba</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end">Qty</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end">Harga Satuan</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end">Sub Total</th>
                                    <th class="mb-0 text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in package %}
                                <tr {% if crud == 'view' %}class="cursor-pointer" data-href="{% url 'order-view' item.order_id item.category_id item.package_id item.type item.id %}"{% endif %}>
                                    <td>
                                        <div class="d-flex pe-2 py-0">
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-xs">{{ item.category.category_name }}</h6>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{{ item.package.package_name }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{% if item.main_cuisine %}{{ item.main_cuisine }}{% endif %}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{% if item.sub_cuisine %}{{ item.sub_cuisine }}{% endif %}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs text-end">{{ item.package.box }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs">{% if item.package.quantity > 0 %}{{ item.type }}{% endif %}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs text-end">{{ item.quantity }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs text-end">{{ item.unit_price|intcomma }}</h6>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-xs text-end">{{ item.total_price|intcomma }}</h6>
                                    </td>
                                    <td>
                                        <button class="btn-icon-only text-dark bg-transparent border-0 p-0 m-0" data-bs-toggle="modal" {% if btn.edit or request.user.is_superuser %}data-bs-target="#delpack-{{ item.id }}"{% else %}disabled{% endif %} {% if crud == 'update' %}disabled{% endif %} {% if data.order_status == 'BATAL' or data.order_status == 'SELESAI' %}disabled{% endif %} {% if package|length == 1 %}disabled{% endif %}><i class="fas fa-times-circle"></i></button>
                                    </td>
                                    <div class="modal fade" id="delpack-{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                        aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="ModalLabel">Konfirmasi</h5>
                                                </div>
                                                <div class="modal-body border-bottom-0">
                                                    Anda yakin akan menghapus pesanan paket <strong>{{ item.package.package_name }}</strong>?
                                                </div>
                                                <div class="modal-footer border-0">
                                                    <button role="button" class="btn bg-gradient-dark" data-bs-dismiss="modal">Batal</button>
                                                    <a href="{% url 'order-package-cs-delete' data.order_id item.id %}" role="button" class="btn bg-gradient-warning text-white">Hapus
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="modal modal-xl fade" id="addPaket" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalLabel">Tambah Paket</h5>
                </div>
                <form id="packForm" method="post" action="{% url 'order-cs-package-add' data.order_id cat pack type %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body border-bottom-0">
                        <div class="pl-lg-0">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-category">Kategori Paket</label>
                                        <select class="form-control form-select-sm" name="category" id="id-category" onchange="window.location.href=this.value" required>
                                            <option value="">Pilih Kategori</option>
                                            {% for item in category %}
                                            <option value="{% url 'order-view' data.order_id item.category_id '0' '0' 'add' %}" {% if item.category_id == cat %}selected{% endif %}>{{ item.category_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="{% if selected_package.quantity > 0 %}col-md-4{% else %}col-md-8{% endif %}">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-package">Paket</label>
                                        <select class="form-control form-select-sm" name="package" id="id-package" onchange="window.location.href=this.value" required>
                                            <option value="">Pilih Paket</option>
                                            {% for item in packages %}
                                            <option value="{% url 'order-view' data.order_id cat item.package_id item.type 'add' %}" {% if item.package_id == pack %}selected{% endif %}>{{ item.package_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% if selected_package.quantity > 0 %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-type">Jenis Kambing</label>
                                        <select class="form-control form-select-sm" name="type" id="id-type" onchange="window.location.href=this.value" required>
                                            {% if selected_package.male_price > 0 %}
                                            <option value="{% url 'order-view' data.order_id cat pack 'Jantan' 'add' %}" {% if type == 'Jantan' %}selected{% endif %}>Jantan</option>
                                            {% endif %}
                                            {% if selected_package.female_price > 0 %}
                                            <option value="{% url 'order-view' data.order_id cat pack 'Betina' 'add' %}" {% if type == 'Betina' %}selected{% endif %}>Betina</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-quantity">Jumlah Paket</label>
                                        <input type="number" name="quantity" id="id-quantity" class="form-control form-control-sm" value="1" required>
                                    </div>
                                </div>
                                {% if selected_package.box > 0 %}
                                <div class="col-md-2">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-box">Box/Paket</label>
                                        <input type="number" name="box" id="id-box" class="form-control form-control-sm" value="{{ selected_package.box }}" disabled>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-md-4 {% if selected_package.box < 1 or not selected_package.box %}d-none{% endif %}">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-box-type">Pilihan Box</label>
                                        <select class="form-control form-select-sm" name="box_type" id="id-box-type" required>
                                            {% if selected_package.box > 0 %}
                                            <option value="">Pilih Box</option>
                                            {% endif %}
                                            {% for item in box %}
                                            <option value="{{ item.equipment.equipment_name }}" {% if item.default == 1 %}selected{% endif %}>{{ item.equipment.equipment_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% if rices %}
                                <div class="col-md-4">
                                    <div class="form-group shadow-none mb-0">
                                        <label for="rice">Pilihan Nasi</label>
                                        <select name="rice" class="form-control form-select-sm" required>
                                            {% for rice in rices %}"
                                            <option value="{{ rice.cuisine.cuisine_name }}" {% if rice.default == 1 %}selected{% endif %}>{{ rice.cuisine.cuisine_name }}{% if rice.extra_price > 0 %} (+ Rp {{ rice.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if main_cuisines %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-main-cuisine">Menu Daging</label>
                                        <select class="form-control form-select-sm" name="main_cuisine" id="id-main-cuisine" required>
                                            <option value="">Pilih Menu Daging</option>
                                            {% for item in main_cuisines %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if sub_cuisines %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-sub-cuisine">Menu Olahan</label>
                                        <select class="form-control form-select-sm" name="sub_cuisine" id="id-sub-cuisine" required>
                                            <option value="">Pilih Menu Olahan</option>
                                            {% for item in sub_cuisines %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines1 %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine1">Menu Pendamping 1</label>
                                        <select class="form-control form-select-sm" name="side_cuisine1" id="id-side-cuisine1" required>
                                            <option value="">Pilih Menu Pendamping 1</option>
                                            {% for item in side_cuisines1 %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if side_cuisines2 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine2">Menu Pendamping 2</label>
                                        <select class="form-control form-select-sm" name="side_cuisine2" id="id-side-cuisine2" required>
                                            <option value="">Pilih Menu Pendamping 2</option>
                                            {% for item in side_cuisines2 %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines3 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine3">Menu Pendamping 3</label>
                                        <select class="form-control form-select-sm" name="side_cuisine3" id="id-side-cuisine3" required>
                                            <option value="">Pilih Menu Pendamping 3</option>
                                            {% for item in side_cuisines3 %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if side_cuisines4 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine4">Menu Pendamping 4</label>
                                        <select class="form-control form-select-sm" name="side_cuisine4" id="id-side-cuisine4" required>
                                            <option value="">Pilih Menu Pendamping 4</option>
                                            {% for item in side_cuisines4 %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines5 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine5">Menu Pendamping 5</label>
                                        <select class="form-control form-select-sm" name="side_cuisine5" id="id-side-cuisine5" required>
                                            <option value="">Pilih Menu Pendamping 5</option>
                                            {% for item in side_cuisines5 %}
                                            <option value="{{ item.cuisine.cuisine_name }}">{{ item.cuisine.cuisine_name }}{% if item.extra_price > 0 %} (+ Rp {{ item.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if bags %}
                                <div class="col-md-6">
                                    <div class="form-group shadow-none mb-0">
                                        <label for="bag">Pilihan Kemasan Kantong</label>
                                        <select name="bag" class="form-control form-select-sm">
                                            {% for bag in bags %}"
                                            <option value="{{ bag.equipment.equipment_name }}" {% if bag.default == 1 %}selected{% endif %}>{{ bag.equipment.equipment_name }}{% if bag.extra_price > 0 %} (+ Rp {{ bag.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if type != '0' %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-unit-price">Harga Per Paket</label>
                                        <input type="text" name="male_price" id="id-male-price" class="form-control form-control-sm {% if type != 'Jantan' %}d-none{% endif %}" value="{{ selected_package.male_price|intcomma }}" readonly>
                                        <input type="text" name="female_price" id="id-female-price" class="form-control form-control-sm {% if type != 'Betina' %}d-none{% endif %}" value="{{ selected_package.female_price|intcomma }}" readonly>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-md-12">
                                    <div class="shadow-none d-none">
                                        <label class="form-control-label" for="id-total-price">Total Harga</label>
                                        <input type="number" name="total_price" id="id-total-price" class="form-control form-control-sm" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <a href="{% url 'order-view' data.order_id '0' '0' '0' '0' %}" role="button" class="btn btn-sm bg-gradient-dark">Batal</a>
                        <button type="button" id="btn-save-paket"
                            class="btn btn-sm bg-gradient-warning text-white {% if not btn.edit and not request.user.is_superuser %}disabled{% endif %}">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="modal modal-xl fade" id="updPack-{{ crud_det }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ModalLabel">Ubah Paket</h5>
                </div>
                <form id="editPackForm" method="post" action="{% url 'order-package-cs-update' data.order_id cat pack type %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body border-bottom-0">
                        <div class="pl-lg-0">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-category">Kategori Paket</label>
                                        <select class="form-control form-select-sm" name="category" id="id-category" onchange="window.location.href=this.value" required disabled>
                                            <option value="">Pilih Kategori</option>
                                            {% for ctg in category %}
                                            <option value="{% url 'order-view' data.order_id ctg.category_id '0' '0' crud_det %}" {% if cat == ctg.category_id %}selected{% endif %}>{{ ctg.category_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="{% if selected_package.quantity > 0 %}col-md-4{% else %}col-md-8{% endif %}">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-package">Paket</label>
                                        <select class="form-control form-select-sm" name="package" id="id-package" onchange="window.location.href=this.value" required disabled>
                                            <option value="">Pilih Paket</option>
                                            {% for pkg in packages_upd %}
                                            <option value="{% url 'order-view' data.order_id cat pkg.package_id pkg.type crud_det %}" {% if pack == pkg.package_id %}selected{% endif %}>{{ pkg.package_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% if selected_package.quantity > 0 %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-type">Jenis Kambing</label>
                                        <select class="form-control form-select-sm" name="type" id="id-type" onchange="window.location.href=this.value" required>
                                            {% if selected_package.male_price > 0 %}
                                            <option value="{% url 'order-view' data.order_id cat pack 'Jantan' crud_det %}" {% if type == 'Jantan' %}selected{% endif %}>Jantan</option>
                                            {% endif %}
                                            {% if selected_package.female_price > 0 %}
                                            <option value="{% url 'order-view' data.order_id cat pack 'Betina' crud_det %}" {% if type == 'Betina' %}selected{% endif %}>Betina</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-quantity">Jumlah Paket</label>
                                        <input type="number" name="quantity" id="id-quantity" class="form-control form-control-sm" value="{{ upd_package.quantity }}" required>
                                    </div>
                                </div>
                                {% if selected_package.box > 0 %}
                                <div class="col-md-2">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-box">Box/Paket</label>
                                        <input type="number" name="box" id="id-box" class="form-control form-control-sm" value="{{ selected_package.box }}" disabled>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-md-4 {% if selected_package.box < 1 or not selected_package.box %}d-none{% endif %}">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-box-type">Pilihan Box</label>
                                        <select class="form-control form-select-sm" name="box_type" id="id-box-type" required>
                                            {% if selected_package.box > 0 %}
                                            <option value="">Pilih Box</option>
                                            {% endif %}
                                            {% for item_box in box %}
                                            <option value="{{ item_box.equipment.equipment_name }}" {% if upd_package.box_type %}{% if item_box.equipment.equipment_name == upd_package.box_type %}selected{% endif %}{% else %}{% if item_box.default == 1 %}selected{% endif %}{% endif %}>{{ item_box.equipment.equipment_name }}{% if item_box.extra_price > 0 %} (+ Rp {{ item_box.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% if rices %}
                                <div class="col-md-4">
                                    <div class="form-group shadow-none mb-0">
                                        <label for="rice">Pilihan Nasi</label>
                                        <select name="rice" class="form-control form-select-sm" required>
                                            {% for rice in rices %}"
                                            <option value="{{ rice.cuisine.cuisine_name }}" {% if upd_package.rice %}{% if rice.cuisine.cuisine_name == upd_package.rice %}selected{% endif %}{% else %}{% if rice.default == 1 %}selected{% endif %}{% endif %}>{{ rice.cuisine.cuisine_name }}{% if rice.extra_price > 0 %} (+ Rp {{ rice.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if main_cuisines %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-main-cuisine">Menu Daging</label>
                                        <select class="form-control form-select-sm" name="main_cuisine" id="id-main-cuisine" required>
                                            <option value="">Pilih Menu Daging</option>
                                            {% for cuisine in main_cuisines %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.main_cuisine == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if sub_cuisines %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-sub-cuisine">Menu Olahan</label>
                                        <select class="form-control form-select-sm" name="sub_cuisine" id="id-sub-cuisine" required>
                                            <option value="">Pilih Menu Olahan</option>
                                            {% for cuisine in sub_cuisines %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.sub_cuisine == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines1 %}
                                <div class="col-md-4">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine1">Menu Pendamping 1</label>
                                        <select class="form-control form-select-sm" name="side_cuisine1" id="id-side-cuisine1" required>
                                            <option value="">Pilih Menu Pendamping 1</option>
                                            {% for cuisine in side_cuisines1 %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.side_cuisine1 == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if side_cuisines2 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine2">Menu Pendamping 2</label>
                                        <select class="form-control form-select-sm" name="side_cuisine2" id="id-side-cuisine2" required>
                                            <option value="">Pilih Menu Pendamping 2</option>
                                            {% for cuisine in side_cuisines2 %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.side_cuisine2 == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines3 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine3">Menu Pendamping 3</label>
                                        <select class="form-control form-select-sm" name="side_cuisine3" id="id-side-cuisine3" required>
                                            <option value="">Pilih Menu Pendamping 3</option>
                                            {% for cuisine in side_cuisines3 %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.side_cuisine3 == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if side_cuisines4 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine4">Menu Pendamping 4</label>
                                        <select class="form-control form-select-sm" name="side_cuisine4" id="id-side-cuisine4" required>
                                            <option value="">Pilih Menu Pendamping 4</option>
                                            {% for cuisine in side_cuisines4 %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.side_cuisine4 == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if side_cuisines5 %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-side-cuisine5">Menu Pendamping 5</label>
                                        <select class="form-control form-select-sm" name="side_cuisine5" id="id-side-cuisine5" required>
                                            <option value="">Pilih Menu Pendamping 5</option>
                                            {% for cuisine in side_cuisines5 %}
                                            <option value="{{ cuisine.cuisine.cuisine_name }}" {% if upd_package.side_cuisine5 == cuisine.cuisine.cuisine_name %}selected{% endif %}>{{ cuisine.cuisine.cuisine_name }}{% if cuisine.extra_price > 0 %} (+ Rp {{ cuisine.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="row">
                                {% if bags %}
                                <div class="col-md-6">
                                    <div class="form-group shadow-none mb-0">
                                        <label for="bag">Pilihan Kemasan Kantong</label>
                                        <select name="bag" class="form-control form-select-sm">
                                            {% for bag in bags %}"
                                            <option value="{{ bag.equipment.equipment_name }}" {% if upd_package.bag %}{% if bag.equipment.equipment_name == upd_package.bag %}selected{% endif %}{% else %}{% if bag.default == 1 %}selected{% endif %}{% endif %}>{{ bag.equipment.equipment_name }}{% if bag.extra_price > 0 %} (+ Rp {{ bag.extra_price|intcomma }}/box){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% endif %}
                                {% if type != '0' %}
                                <div class="col-md-6">
                                    <div class="shadow-none">
                                        <label class="form-control-label" for="id-unit-price">Harga Per Paket</label>
                                        <input type="text" name="male_price" id="id-male-price" class="form-control form-control-sm {% if type != 'Jantan' %}d-none{% endif %}" value="{{ selected_package.male_price|intcomma }}" readonly>
                                        <input type="text" name="female_price" id="id-female-price" class="form-control form-control-sm {% if type != 'Betina' %}d-none{% endif %}" value="{{ selected_package.female_price|intcomma }}" readonly>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="col-md-12">
                                    <div class="shadow-none d-none">
                                        <label class="form-control-label" for="id-total-price">Total Harga</label>
                                        <input type="number" name="total_price" id="id-total-price" class="form-control form-control-sm" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <a href="{% url 'order-view' data.order_id '0' '0' '0' '0' %}" role="button" class="btn btn-sm bg-gradient-dark">Batal</a>
                        <button type="button" id="btn-edit-paket"
                            class="btn btn-sm bg-gradient-warning text-white {% if not btn.edit and not request.user.is_superuser %}disabled{% endif %} {% if status == 'BATAL' or status == 'SELESAI' %}disabled{% else %}{% if crud == 'update' %}disabled{% endif %}{% endif %}">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block javascripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#childTable').DataTable({
            'searching': false,
            'lengthChange': false,
            'paging': false,
            'info': false,
            'cell-border': true,
            'order': [[1, 'asc']],
        });
        $('#packTable').DataTable({
            'searching': false,
            'lengthChange': false,
            'paging': false,
            'info': false,
            'cell-border': true,
        });
    });

    $(document).on('click', 'tbody tr td:not(:last-child)', function() {
        var href = $(this).parent().data('href');
        if(href) { // Check if href data exists
            window.location = href;
        } else {
            console.log("No data in href");
        }
    });

    let crudStatus = '{{ crud_det }}';
    const modal_add = document.getElementById('addPaket');
    const modalAdd = new bootstrap.Modal(modal_add);
    const modal_edit = document.getElementById('updPack-{{ crud_det }}');
    const modalEdit = new bootstrap.Modal(modal_edit);
    
    if (crudStatus == 'add') {
        modalAdd.show();
        modalAdd._config.keyboard = false;
    } else if (crudStatus != '0') {
        modalEdit.show();
        modalEdit._config.keyboard = false;
    }

    let btnSaveOrder = document.getElementById('save-btn');
    let btnSavePaket = document.getElementById('btn-save-paket');
    let btnEditPaket = document.getElementById('btn-edit-paket');
    let orderForm = document.getElementById('order-form');
    let packForm = document.getElementById('packForm');
    let editPackForm = document.getElementById('editPackForm');

    btnSaveOrder.addEventListener('click', function () {
        orderForm.submit();
    });

    btnSavePaket.addEventListener('click', function () {
        packForm.submit();
    });

    btnEditPaket.addEventListener('click', function () {
        editPackForm.submit();
    });

    btnSavePaket.addEventListener('click', function () {
        let quantity = document.getElementById('id-quantity').value;
        let unitPrice = document.getElementById('id-unit-price').value;
        let totalPrice = document.getElementById('id-total-price');

        totalPrice.value = quantity * unitPrice;
    });

    $(document).ready(function() {
        let modal = document.getElementsByClassName('modal');
        
        for (const item of modal) {
            item.addEventListener('show.bs.modal', function() {
                // remove z-index-0 from nearest parent card class
                item.closest('.card').classList.remove('z-index-0');
            });
            item.addEventListener('hidden.bs.modal', function() {
                // add z-index-0 from nearest card class
                item.closest('.card').classList.add('z-index-0');
            });
        }
    });
    
    let btn_menu = document.getElementById('dropdownTable');
    let btn_anak = document.getElementById('dropdownAnak');
    let btn_paket = document.getElementById('dropdownPaket');
    let dropdown_menu = document.getElementsByClassName('dropdown-menu');
    
    // open dropdown menu
    btn_menu.addEventListener('click', function() {
        dropdown_menu[0].classList.toggle('show');
    });

    btn_anak.addEventListener('click', function() {
        dropdown_menu[1].classList.toggle('show');
    });

    btn_paket.addEventListener('click', function() {
        dropdown_menu[2].classList.toggle('show');
    });
</script>
{% endblock javascripts %}
